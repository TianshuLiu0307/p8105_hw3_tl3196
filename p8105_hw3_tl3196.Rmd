---
title: "p8105_hw3_tl3196"
author: "Tianshu Liu"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r tidyverse}
library(tidyverse)
library(ggplot2)
```


## Problem 1
```{r import_instacart}
library(p8105.datasets)
data("instacart")
```

The instacart data set is ``r nrow(instacart)``×``r ncol(instacart)``.

The variables contain ``r colnames(instacart)``, the data type in each variable is shown in the table below:

```{r column_info, echo=FALSE}
col_names = colnames(instacart)
col_types = c()
for (col in col_names){
  col_types = c(col_types, class(pull(instacart, col)))
}

knitr::kable(
  tibble(col_names, col_types)
)
```


```{r aisle_count}
aisle_count = 
instacart %>%
  group_by(aisle) %>%
  summarise(n = n()) %>%
  arrange(desc(n))

aisle_count
```
The instacart data set contains ``r nrow(aisle_count)`` aisles.

Make a plot that shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered. Arrange aisles sensibly, and organize your plot so others can read it.

```{r aisle_plot}
aisle_count %>%
  filter(n > 10000) %>%
  ggplot(aes(x = reorder(aisle, -n), y = n)) +
  geom_bar(stat="identity", fill = "lightblue")+
  labs(
    x = "Aisles",
    y = "Number of Items",
    title = "Number of Items Ordered in the Top Aisles",
    caption = "@instacart"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 
```

Make a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”. Include the number of times each item is ordered in your table.

```{r top_3_in_baking}
instacart %>%
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  select(product_name, aisle) %>% 
  group_by(aisle, product_name) %>%
  summarise(
    n_product = n()
  ) %>% 
  mutate(
    product_rank = min_rank(desc(n_product))
  ) %>% 
  filter(product_rank < 4) %>% 
  arrange(aisle, product_rank)
```

Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week; format this table for human readers (i.e. produce a 2 x 7 table).

```{r mean_order_hour}
instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarise(
    mean_order_hour = mean(order_hour_of_day)
  ) %>% 
  mutate(
    order_dow = factor(
      order_dow,levels=0:6,
      labels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
  ) %>% 
  pivot_wider(
    names_from = order_dow,
    values_from = mean_order_hour
  )
```

# Problem 2

Import data from `accel_data.csv`.

```{r import_accel}
accel_df = read_csv("./data/accel_data.csv") %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols = activity_1:activity_1440,
    names_prefix = "activity_",
    names_to = "minute_of_day",
    names_transform = list(minute_of_day = as.integer),
    values_to = "n_activity"
  ) %>% 
  mutate(
    weekday_vs_weekend = ifelse(day %in% c("Saturday", "Sunday"), "weekend", "weekday"),
    week = as.integer(week),
    day_id = as.integer(day_id)
  ) %>%
  relocate(weekday_vs_weekend, .after = day)

accel_df
```

This data set contains ``r ncol(accel_df)`` variables, which are ``r colnames(accel_df)``.

```{r caccel_col_info, echo=FALSE}
col_names = colnames(accel_df)
col_types = c()
for (col in col_names){
  col_types = c(col_types, class(pull(accel_df, col)))
}
explanation = c(
  "which week in the obervation period",
  "which day in the observation period",
  "what day is it",
  "it is on weekday or weekend",
  "the minute of a day",
  "number of activities happeded in this minute"
)
knitr::kable(
  tibble(col_names, col_types, explanation)
)
```

There are ``r nrow(accel_df)`` rows of observations in the data set.

Then, analyze the accelerometer data focus on the total activity over the day.

```{r day_total_act}
day_total_act = 
  accel_df %>%
  group_by(day_id, day) %>% 
  summarise(
    day_total_activity = sum(n_activity)
  )

day_total_act

day_total_act %>% 
  ggplot(aes(x = day_id, y = day_total_activity))+
  geom_line(color = "blue") +
  theme_minimal() +
  labs(
    title = "Total activities over the day"
  )
```

From the table and lineplot, there is not apparent trend of the total activities over each day in the observation period.

Accelerometer data allows the inspection activity over the course of the day. Make a single-panel plot that shows the 24-hour activity time courses for each day and use color to indicate day of the week. Describe in words any patterns or conclusions you can make based on this graph.

```{r panel}
library(patchwork)

week1 = 
accel_df %>% 
  filter(week == 1) %>% 
  ggplot(aes(x = minute_of_day, y = n_activity, color = day_id)) +
  xlim(0,1440) +
  scale_y_continuous(breaks = c(0, 2000, 4000, 6000, 8000)) +
  geom_line() + 
  theme_minimal() 

week2 = 
accel_df %>% 
  filter(week == 2) %>% 
  ggplot(aes(x = minute_of_day, y = n_activity, color = day_id)) +
  xlim(0,1440) +
  scale_y_continuous(breaks = c(0, 2000, 4000, 6000, 8000)) +
  geom_line() + 
  theme_minimal() 

week3 = 
accel_df %>% 
  filter(week == 3) %>% 
  ggplot(aes(x = minute_of_day, y = n_activity, color = day_id)) +
  xlim(0,1440) +
  scale_y_continuous(breaks = c(0, 2000, 4000, 6000, 8000)) +
  geom_line() + 
  theme_minimal() 

week4 = 
accel_df %>% 
  filter(week == 4) %>% 
  ggplot(aes(x = minute_of_day, y = n_activity, color = day_id)) +
  xlim(0,1440) +
  scale_y_continuous(breaks = c(0, 2000, 4000, 6000, 8000)) +
  geom_line() + 
  theme_minimal() 

week5 = 
accel_df %>% 
  filter(week == 5) %>% 
  ggplot(aes(x = minute_of_day, y = n_activity, color = day_id)) +
  xlim(0,1440) +
  scale_y_continuous(breaks = c(0, 2000, 4000, 6000, 8000)) +
  geom_line() + 
  theme_minimal() 

(week1 + week2) / (week3) / (week4 + week5)
```

